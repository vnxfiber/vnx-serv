<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidatos - Administração VNX</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        .sidebar {
            width: 250px;
            background-color: #0a3d62; /* Azul VNX */
            color: #fff;
            padding-top: 1rem;
            position: fixed;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .sidebar .logo {
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .sidebar .logo img {
            max-width: 80%;
            height: auto;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px; /* Align icons */
            text-align: center;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .sidebar .user-info {
             margin-top: auto; /* Push to bottom */
             padding: 1rem 1.5rem;
             border-top: 1px solid rgba(255, 255, 255, 0.2);
             font-size: 0.9rem;
        }
        .sidebar .user-info a {
            color: #ffc107; /* Yellow accent for logout */
            text-decoration: none;
        }
        .main-content {
            margin-left: 250px; /* Same as sidebar width */
            padding: 2rem;
            flex-grow: 1;
            overflow-y: auto; /* Allow content scrolling */
        }
        .page-header {
             margin-bottom: 2rem;
             padding-bottom: 1rem;
             border-bottom: 1px solid #dee2e6;
        }
        .page-header h1 {
             color: #0a3d62;
        }
        .table th {
            background-color: #e9ecef;
            color: #0a3d62;
            font-weight: 600;
        }
        .table td .badge {
            font-size: 0.85em;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .filter-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
            background-color: #fff;
            border-radius: 8px;
            margin-top: 2rem;
        }
        .empty-state img {
            max-width: 150px;
            margin-bottom: 1.5rem;
            opacity: 0.7;
        }
        .empty-state p {
            color: #6c757d;
            font-size: 1.1rem;
        }
        .status-badge {
            min-width: 80px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="logo">
             <!-- Make sure the logo path is correct -->
            <a href="{{ url_for('admin_dashboard') }}"><img src="{{ url_for('static', filename='assets/logo-white.svg') }}" alt="VNX Logo"></a>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{{ url_for('admin_candidatos') }}">
                    <i class="fas fa-users"></i> Candidatos
                </a>
            </li>
            <!-- Add more navigation items here -->
        </ul>
         <div class="user-info">
            <small>Logado como: {{ user.email }}</small><br>
            <a href="{{ url_for('admin_logout') }}"><i class="fas fa-sign-out-alt"></i> Sair</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="page-header d-flex justify-content-between align-items-center">
            <h1>Candidatos</h1>
            <div>
                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exportModal">
                    <i class="fas fa-file-export me-2"></i>Exportar
                </button>
            </div>
        </header>

        <!-- Filtros -->
        <div class="filter-card p-3 mb-4">
            <form method="get" action="{{ url_for('admin_candidatos') }}" class="row g-3">
                <div class="col-md-4">
                    <label for="busca" class="form-label">Buscar</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="busca" name="busca" 
                               placeholder="Nome ou e-mail" value="{{ request.args.get('busca', '') }}">
                        <button class="btn btn-outline-secondary" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="estado" class="form-label">Estado</label>
                    <select class="form-select" id="estado" name="estado">
                        <option value="">Todos</option>
                        {% for estado in estados %}
                            <option value="{{ estado }}" {% if request.args.get('estado') == estado %}selected{% endif %}>{{ estado }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" id="status" name="status">
                        <option value="">Todos</option>
                        <option value="pendente" {% if request.args.get('status') == 'pendente' %}selected{% endif %}>Pendente</option>
                        <option value="contato_realizado" {% if request.args.get('status') == 'contato_realizado' %}selected{% endif %}>Contato Realizado</option>
                        <option value="em_analise" {% if request.args.get('status') == 'em_analise' %}selected{% endif %}>Em Análise</option>
                        <option value="aprovado" {% if request.args.get('status') == 'aprovado' %}selected{% endif %}>Aprovado</option>
                        <option value="reprovado" {% if request.args.get('status') == 'reprovado' %}selected{% endif %}>Reprovado</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                </div>
            </form>
        </div>

        <!-- Listagem de Candidatos -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Lista de Candidatos</h4>
                <span class="badge bg-secondary">{{ total_candidatos }} candidato(s)</span>
            </div>
            <div class="card-body">
                {% if candidatos %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nome / Razão Social</th>
                                    <th>Contato</th>
                                    <th>Localização</th>
                                    <th>Especialidades</th>
                                    <th>Data</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for candidato in candidatos %}
                                <tr>
                                    <td>{{ candidato.id }}</td>
                                    <td>{{ candidato.nome_completo }}</td>
                                    <td>
                                        <i class="fas fa-envelope me-1 text-muted"></i> {{ candidato.email }}<br>
                                        <i class="fab fa-whatsapp me-1 text-success"></i> {{ candidato.whatsapp }}
                                    </td>
                                    <td>{{ candidato.cidade_estado }}</td>
                                    <td>
                                        {% if candidato.especialidades %}
                                            {% set especialidades_list = candidato.especialidades.split(',') if ',' in candidato.especialidades else [candidato.especialidades] %}
                                            {% for esp in especialidades_list %}
                                                <span class="badge bg-secondary">{{ esp.strip() }}</span>
                                            {% endfor %}
                                        {% else %}
                                            <small class="text-muted">Não informado</small>
                                        {% endif %}
                                    </td>
                                    <td>{{ candidato.data_cadastro.strftime('%d/%m/%Y %H:%M') if candidato.data_cadastro else 'N/A' }}</td>
                                    <td>
                                        {% if candidato.status == 'pendente' %}
                                            <span class="badge bg-warning status-badge">Pendente</span>
                                        {% elif candidato.status == 'contato_realizado' %}
                                            <span class="badge bg-info status-badge">Contato Realizado</span>
                                        {% elif candidato.status == 'em_analise' %}
                                            <span class="badge bg-primary status-badge">Em Análise</span>
                                        {% elif candidato.status == 'aprovado' %}
                                            <span class="badge bg-success status-badge">Aprovado</span>
                                        {% elif candidato.status == 'reprovado' %}
                                            <span class="badge bg-danger status-badge">Reprovado</span>
                                        {% else %}
                                            <span class="badge bg-secondary status-badge">{{ candidato.status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"
                                                    data-bs-toggle="modal" data-bs-target="#detailsModal{{ candidato.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" title="Alterar Status"
                                                    data-bs-toggle="modal" data-bs-target="#statusModal{{ candidato.id }}">
                                                <i class="fas fa-exchange-alt"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger" title="Excluir"
                                                    data-bs-toggle="modal" data-bs-target="#deleteModal{{ candidato.id }}">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginação -->
                    <div class="pagination-container">
                        <nav aria-label="Paginação">
                            <ul class="pagination">
                                <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('admin_candidatos', page=current_page-1, **request.args) if current_page > 1 else '#' }}" aria-label="Anterior">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                {% for page_num in range(1, total_pages + 1) %}
                                    <li class="page-item {% if page_num == current_page %}active{% endif %}">
                                        <a class="page-link" href="{{ url_for('admin_candidatos', page=page_num, **request.args) }}">{{ page_num }}</a>
                                    </li>
                                {% endfor %}
                                <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                                    <a class="page-link" href="{{ url_for('admin_candidatos', page=current_page+1, **request.args) if current_page < total_pages else '#' }}" aria-label="Próxima">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <img src="{{ url_for('static', filename='assets/empty-state.svg') }}" alt="Sem dados">
                        <p>Nenhum candidato encontrado com os filtros selecionados.</p>
                        <a href="{{ url_for('admin_candidatos') }}" class="btn btn-primary">Limpar filtros</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </main>

    <!-- Modal de Exportação -->
    <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">Exportar Candidatos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <form action="{{ url_for('exportar_candidatos') }}" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Formato de exportação</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="formato" id="formatoExcel" value="excel" checked>
                                <label class="form-check-label" for="formatoExcel">
                                    <i class="fas fa-file-excel text-success me-2"></i>Excel (.xlsx)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="formato" id="formatoCSV" value="csv">
                                <label class="form-check-label" for="formatoCSV">
                                    <i class="fas fa-file-csv text-primary me-2"></i>CSV
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Escopo</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="escopo" id="escopoTodos" value="todos" checked>
                                <label class="form-check-label" for="escopoTodos">
                                    Todos os candidatos
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="escopo" id="escopoFiltrados" value="filtrados">
                                <label class="form-check-label" for="escopoFiltrados">
                                    Apenas candidatos filtrados
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-download me-2"></i>Exportar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modais para detalhes, status e exclusão dos candidatos (seriam gerados em loop) -->
    {% for candidato in candidatos %}
        <!-- Modal de Detalhes -->
        <div class="modal fade" id="detailsModal{{ candidato.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Detalhes do Candidato</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">Nome / Razão Social:</label>
                                <p>{{ candidato.nome_completo }}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">Email:</label>
                                <p>{{ candidato.email }}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">WhatsApp:</label>
                                <p>{{ candidato.whatsapp }}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">Localização:</label>
                                <p>{{ candidato.cidade_estado }}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">Data de Cadastro:</label>
                                <p>{{ candidato.data_cadastro.strftime('%d/%m/%Y %H:%M') if candidato.data_cadastro else 'N/A' }}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="fw-bold">Status:</label>
                                <p>
                                    {% if candidato.status == 'pendente' %}
                                        <span class="badge bg-warning">Pendente</span>
                                    {% elif candidato.status == 'contato_realizado' %}
                                        <span class="badge bg-info">Contato Realizado</span>
                                    {% elif candidato.status == 'em_analise' %}
                                        <span class="badge bg-primary">Em Análise</span>
                                    {% elif candidato.status == 'aprovado' %}
                                        <span class="badge bg-success">Aprovado</span>
                                    {% elif candidato.status == 'reprovado' %}
                                        <span class="badge bg-danger">Reprovado</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ candidato.status }}</span>
                                    {% endif %}
                                </p>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="fw-bold">Especialidades:</label>
                                <p>
                                    {% if candidato.especialidades %}
                                        {% set especialidades_list = candidato.especialidades.split(',') if ',' in candidato.especialidades else [candidato.especialidades] %}
                                        {% for esp in especialidades_list %}
                                            <span class="badge bg-secondary">{{ esp.strip() }}</span>
                                        {% endfor %}
                                    {% else %}
                                        <small class="text-muted">Não informado</small>
                                    {% endif %}
                                </p>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="fw-bold">Experiência e Certificações:</label>
                                <div class="p-3 bg-light rounded">
                                    {{ candidato.experiencia|nl2br|default('<small class="text-muted">Não informado</small>', true)|safe }}
                                </div>
                            </div>
                            {% if candidato.links %}
                            <div class="col-12 mb-3">
                                <label class="fw-bold">Links:</label>
                                <p>
                                    <a href="{{ candidato.links }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-1"></i> Acessar Link
                                    </a>
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Status -->
        <div class="modal fade" id="statusModal{{ candidato.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Atualizar Status</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <form action="{{ url_for('atualizar_status_candidato', id=candidato.id) }}" method="post">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="status{{ candidato.id }}" class="form-label">Status do Candidato</label>
                                <select class="form-select" id="status{{ candidato.id }}" name="status" required>
                                    <option value="pendente" {% if candidato.status == 'pendente' %}selected{% endif %}>Pendente</option>
                                    <option value="contato_realizado" {% if candidato.status == 'contato_realizado' %}selected{% endif %}>Contato Realizado</option>
                                    <option value="em_analise" {% if candidato.status == 'em_analise' %}selected{% endif %}>Em Análise</option>
                                    <option value="aprovado" {% if candidato.status == 'aprovado' %}selected{% endif %}>Aprovado</option>
                                    <option value="reprovado" {% if candidato.status == 'reprovado' %}selected{% endif %}>Reprovado</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal de Exclusão -->
        <div class="modal fade" id="deleteModal{{ candidato.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirmar Exclusão</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <p>Tem certeza que deseja excluir o candidato <strong>{{ candidato.nome_completo }}</strong>?</p>
                        <p class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Esta ação não pode ser desfeita.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <form action="{{ url_for('excluir_candidato', id=candidato.id) }}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger">Excluir</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 